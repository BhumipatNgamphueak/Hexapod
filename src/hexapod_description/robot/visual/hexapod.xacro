<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="hexapod">

    <xacro:include filename="$(find hexapod_description)/robot/visual/inertial_macros.xacro" />
    <xacro:include filename="$(find hexapod_description)/robot/visual/hexapod_params.xacro" />
    <xacro:include filename="$(find hexapod_description)/robot/visual/robot_material.xacro" />
    <xacro:include filename="$(find hexapod_description)/robot/visual/gazebo_full.xacro" />

    <!-- BASE LINK -->
    <link name="base_link">
        <inertial>
            <origin xyz="9.6259709536084E-06 -6.03599555802636E-06 -0.0030214605278231" rpy="0 0 0" />
            <mass value="${mass_base}" />
            <inertia
                ixx="0.00164228924294238"
                ixy="-1.28564474462014E-09"
                ixz="8.22610664375957E-10"
                iyy="0.00164233674483393"
                iyz="-1.98002919852351E-10"
                izz="0.00328367106870498" />
        </inertial>
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <geometry>
                <mesh filename="package://hexapod_description/meshes/base_link.STL" />
            </geometry>
            <material name="white"/>
        </visual>
        <collision>
            <origin xyz="0 0 0.002" rpy="0 0 0" />
            <geometry>
                <cylinder radius="0.11" length="0.064"/>
            </geometry>
        </collision>
    </link>

    <!-- LEG MACRO -->
    <xacro:macro name="hexapod_leg" params="leg_num hip_origin_xyz hip_origin_rpy">
        
        <!-- HIP LINK -->
        <link name="hip_link_${leg_num}">
            <inertial>
                <origin xyz="0.0488185085747303 -0.00410063867439833 0.00163326248081042" rpy="0 0 0" />
                <mass value="${mass_hip}" />
                <inertia
                    ixx="9.38773089300775E-05"
                    ixy="8.87632856357308E-06"
                    ixz="2.7266876743089E-06"
                    iyy="0.000124049448056631"
                    iyz="-2.29027568962667E-07"
                    izz="0.00012170057198104" />
            </inertial>
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://hexapod_description/meshes/hip_link_1.STL" />
                </geometry>
                <material name="orange"/>
            </visual>
            <collision>
                <origin xyz="0.0445 -0.0013 -0.0015" rpy="0 0 0" />
                <geometry>
                    <box size="0.126 0.061 0.077"/>
                </geometry>
            </collision>
        </link>

        <!-- HIP JOINT -->
        <joint name="hip_joint_${leg_num}" type="revolute">
            <origin xyz="${hip_origin_xyz}" rpy="${hip_origin_rpy}" />
            <parent link="base_link" />
            <child link="hip_link_${leg_num}" />
            <axis xyz="0 0 1" />
            <limit effort="${joint_effort}" velocity="${joint_velocity}" 
                   lower="${hip_lower_limit}" upper="${hip_upper_limit}" />
            <dynamics damping="${hip_damping}" friction="${hip_friction}"/>
        </joint>

        <!-- KNEE LINK -->
        <link name="knee_link_${leg_num}">
            <inertial>
                <origin xyz="-0.0475302249354476 -0.0303949843623502 -0.00382639103091394" rpy="0 0 0" />
                <mass value="${mass_knee}" />
                <inertia
                    ixx="0.000125689460160167"
                    ixy="-8.60189768522736E-05"
                    ixz="-1.49872305256315E-06"
                    iyy="0.000137645360683419"
                    iyz="-1.51278826167929E-06"
                    izz="0.000224456017656395" />
            </inertial>
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://hexapod_description/meshes/knee_link_1.STL" />
                </geometry>
                <material name="blue"/>
            </visual>
            <collision>
                <origin xyz="-0.0484 -0.0449 -0.0011" rpy="0 0 0" />
                <geometry>
                    <box size="0.134 0.129 0.080"/>
                </geometry>
            </collision>
        </link>

        <!-- KNEE JOINT -->
        <joint name="knee_joint_${leg_num}" type="revolute">
            <origin xyz="${knee_joint_x} ${knee_joint_y} ${knee_joint_z}" 
                    rpy="1.5708 1.5708 3.142" />
            <parent link="hip_link_${leg_num}" />
            <child link="knee_link_${leg_num}" />
            <axis xyz="0 0 1" />
            <limit effort="${joint_effort}" velocity="${joint_velocity}" 
                   lower="${knee_lower_limit}" upper="${knee_upper_limit}" />
            <dynamics damping="${knee_damping}" friction="${knee_friction}"/>
        </joint>

        <!-- ANKLE LINK -->
        <link name="ankle_link_${leg_num}">
            <inertial>
                <origin xyz="0.0767237006476303 -0.013659210334669 -0.00149577098480455" rpy="0 0 0" />
                <mass value="${mass_ankle}" />
                <inertia
                    ixx="0.000120289050869526"
                    ixy="1.98010146951448E-05"
                    ixz="-2.69503214059816E-06"
                    iyy="0.000196681888150522"
                    iyz="1.37145509688599E-06"
                    izz="0.000177107331195337" />
            </inertial>
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://hexapod_description/meshes/ankle_link_1.STL" />
                </geometry>
                <material name="grey"/>
            </visual>
            <collision>
                <origin xyz="0.0717 -0.0069 -0.0059" rpy="0 1.5708 0" />
                <geometry>
                    <cylinder radius="0.038" length="0.203"/>
                </geometry>
            </collision>
        </link>

        <!-- ANKLE JOINT -->
        <joint name="ankle_joint_${leg_num}" type="revolute">
            <origin xyz="${ankle_joint_x} ${ankle_joint_y} ${ankle_joint_z}" rpy="0 0 0" />
            <parent link="knee_link_${leg_num}" />
            <child link="ankle_link_${leg_num}" />
            <axis xyz="0 0 1" />
            <limit effort="${joint_effort}" velocity="${joint_velocity}" 
                   lower="${ankle_lower_limit}" upper="${ankle_upper_limit}" />
            <dynamics damping="${ankle_damping}" friction="${ankle_friction}"/>
        </joint>

        <!-- FOOT POINTER LINK -->
        <link name="foot_pointer_${leg_num}">
            <inertial>
                <origin xyz="-0.0049782363018493 0.000584199635433796 1.01521888723546E-05" rpy="0 0 0" />
                <mass value="${mass_foot_pointer}" />
                <inertia
                    ixx="3.1794072605368E-07"
                    ixy="1.15940615410597E-08"
                    ixz="2.00382787922864E-10"
                    iyy="4.0938199625732E-07"
                    iyz="-5.71299980008936E-11"
                    izz="4.12726877457262E-07" />
            </inertial>
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://hexapod_description/meshes/foot_pointer_1.STL" />
                </geometry>
                <material name="grey"/>
            </visual>
            <collision>
                <origin xyz="-0.0081 0.0008 0" rpy="0 0 0" />
                <geometry>
                    <box size="0.032 0.023 0.022"/>
                </geometry>
            </collision>
        </link>

        <!-- FOOT POINTER JOINT -->
        <joint name="foot_pointer_joint_${leg_num}" type="fixed">
            <origin xyz="${foot_pointer_joint_x} ${foot_pointer_joint_y} 0" rpy="0 0 0" />
            <parent link="ankle_link_${leg_num}" />
            <child link="foot_pointer_${leg_num}" />
        </joint>

        <!-- END EFFECTOR LINK -->
        <link name="end_effector_${leg_num}">
            <inertial>
                <origin xyz="-0.0122067463278634 0.00152370640892938 6.47355637194841E-06" rpy="0 0 0" />
                <mass value="${mass_end_effector}" />
                <inertia
                    ixx="3.11902997781583E-07"
                    ixy="1.22998576021055E-08"
                    ixz="2.12679032607798E-10"
                    iyy="4.0890866624375E-07"
                    iyz="4.13472457938764E-11"
                    izz="4.06602736445781E-07" />
            </inertial>
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://hexapod_description/meshes/end_effector_1.STL" />
                </geometry>
                <material name="grey"/>
            </visual>
            <collision>
                <origin xyz="-0.0157 0.0014 0" rpy="0 0 0" />
                <geometry>
                    <box size="0.032 0.022 0.022"/>
                </geometry>
            </collision>
        </link>

        <!-- END EFFECTOR JOINT -->
        <joint name="end_effector_joint_${leg_num}" type="fixed">
            <origin xyz="${end_effector_joint_x} ${end_effector_joint_y} 0" rpy="0 0 0" />
            <parent link="foot_pointer_${leg_num}" />
            <child link="end_effector_${leg_num}" />
        </joint>

        <!-- FOOT CONTACT SPHERE -->
        <link name="foot_contact_${leg_num}">
            <xacro:inertial_sphere mass="${foot_contact_mass}" radius="${foot_contact_radius}">
                <origin xyz="0 0 0" rpy="0 0 0"/>
            </xacro:inertial_sphere>
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0"/>
                <geometry>
                    <sphere radius="${foot_contact_radius}"/>
                </geometry>
                <material name="black"/>
            </visual>
            <collision>
                <origin xyz="0 0 0" rpy="0 0 0"/>
                <geometry>
                    <sphere radius="${foot_contact_radius}"/>
                </geometry>
            </collision>
        </link>

        <!-- FOOT CONTACT JOINT -->
        <joint name="foot_contact_joint_${leg_num}" type="fixed">
            <origin xyz="-0.012 0.0015 0" rpy="0 0 0" />
            <parent link="end_effector_${leg_num}" />
            <child link="foot_contact_${leg_num}" />
        </joint>

    </xacro:macro>

    <!-- INSTANTIATE 6 LEGS -->
    <xacro:hexapod_leg leg_num="1" 
                       hip_origin_xyz="-1.2616E-05 -0.095255 0" 
                       hip_origin_rpy="0 0 -1.5708" />

    <xacro:hexapod_leg leg_num="2" 
                       hip_origin_xyz="0.082487 -0.047638 0" 
                       hip_origin_rpy="0 0 -0.5236" />

    <xacro:hexapod_leg leg_num="3" 
                       hip_origin_xyz="0.082499 0.047616 0" 
                       hip_origin_rpy="0 0 0.5236" />

    <xacro:hexapod_leg leg_num="4" 
                       hip_origin_xyz="1.2616E-05 0.095255 0" 
                       hip_origin_rpy="0 0 1.5708" />

    <xacro:hexapod_leg leg_num="5" 
                       hip_origin_xyz="-0.082487 0.047638 0" 
                       hip_origin_rpy="0 0 2.618" />

    <xacro:hexapod_leg leg_num="6" 
                       hip_origin_xyz="-0.082499 -0.047616 0" 
                       hip_origin_rpy="0 0 -2.618" />

</robot>